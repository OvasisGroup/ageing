generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model bookings {
  id                               String        @id
  customerId                       String
  providerId                       String
  categoryId                       String
  title                            String
  description                      String?
  startTime                        DateTime
  endTime                          DateTime
  duration                         Int
  status                           BookingStatus @default(PENDING)
  budget                           Float?
  googleEventId                    String?
  location                         String?
  notes                            String?
  cancellationReason               String?
  createdAt                        DateTime      @default(now())
  updatedAt                        DateTime
  categories                       categories    @relation(fields: [categoryId], references: [id])
  users_bookings_customerIdTousers users         @relation("bookings_customerIdTousers", fields: [customerId], references: [id], onDelete: Cascade)
  users_bookings_providerIdTousers users         @relation("bookings_providerIdTousers", fields: [providerId], references: [id], onDelete: Cascade)
  reviews                          reviews[]
}

model categories {
  id               String             @id
  title            String
  description      String?
  image            String?
  slug             String             @unique
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  bookings         bookings[]
  service_requests service_requests[]
  subcategories    subcategories[]
}

model inquiries {
  id        String          @id
  name      String
  email     String
  message   String
  status    InquiryStatus   @default(PENDING)
  createdAt DateTime        @default(now())
  updatedAt DateTime
  phone     String
  priority  InquiryPriority @default(MEDIUM)
  subject   String
}

model newsletter_subscriptions {
  id           String   @id
  email        String   @unique
  name         String?
  isActive     Boolean  @default(true)
  subscribedAt DateTime @default(now())
  updatedAt    DateTime
}

model reviews {
  id                              String    @id
  rating                          Int
  comment                         String?
  customerId                      String
  providerId                      String
  bookingId                       String?
  createdAt                       DateTime  @default(now())
  updatedAt                       DateTime
  bookings                        bookings? @relation(fields: [bookingId], references: [id])
  users_reviews_customerIdTousers users     @relation("reviews_customerIdTousers", fields: [customerId], references: [id], onDelete: Cascade)
  users_reviews_providerIdTousers users     @relation("reviews_providerIdTousers", fields: [providerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([providerId])
}

model service_requests {
  id            String               @id
  userId        String
  categoryId    String
  subcategoryId String?
  title         String
  description   String
  location      String
  locationLat   Float?
  locationLng   Float?
  budget        Float?
  serviceDate   DateTime
  status        ServiceRequestStatus @default(PENDING)
  createdAt     DateTime             @default(now())
  updatedAt     DateTime
  categories    categories           @relation(fields: [categoryId], references: [id])
  subcategories subcategories?       @relation(fields: [subcategoryId], references: [id])
  users         users                @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model subcategories {
  id               String             @id
  title            String
  description      String?
  image            String?
  slug             String             @unique
  isActive         Boolean            @default(true)
  categoryId       String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  service_requests service_requests[]
  categories       categories         @relation(fields: [categoryId], references: [id], onDelete: Cascade)
}

model users {
  id                                  String             @id
  username                            String             @unique
  email                               String             @unique
  password                            String
  role                                Role               @default(CUSTOMER)
  firstName                           String?
  lastName                            String?
  phone                               String?
  businessName                        String?
  businessAddress                     String?
  licenseNumber                       String?
  yearsOfExperience                   Int?
  description                         String?
  createdAt                           DateTime           @default(now())
  updatedAt                           DateTime
  address                             String?
  averageRating                       Float?
  certifications                      Json[]             @default([])
  emailVerified                       Boolean            @default(false)
  googleCalendarAccessToken           String?
  googleCalendarRefreshToken          String?
  googleCalendarTokenExpiry           DateTime?
  insuranceDocuments                  String[]           @default([])
  insuranceExpiryDate                 DateTime?
  insurancePolicyNumber               String?
  insuranceProvider                   String?
  parentUserId                        String?
  permissions                         String[]           @default([])
  profilePhoto                        String?
  subRole                             SubRole?
  totalReviews                        Int                @default(0)
  verificationToken                   String?
  verificationTokenExpiry             DateTime?
  vettedAt                            DateTime?
  vettedBy                            String?
  vettedStatus                        VettedStatus       @default(NOT_VETTED)
  workersCompDocuments                String[]           @default([])
  workersCompExpiryDate               DateTime?
  workersCompPolicyNumber             String?
  workersCompProvider                 String?
  zipCode                             String?
  serviceType                         String?
  bookings_bookings_customerIdTousers bookings[]         @relation("bookings_customerIdTousers")
  bookings_bookings_providerIdTousers bookings[]         @relation("bookings_providerIdTousers")
  reviews_reviews_customerIdTousers   reviews[]          @relation("reviews_customerIdTousers")
  reviews_reviews_providerIdTousers   reviews[]          @relation("reviews_providerIdTousers")
  service_requests                    service_requests[]
  users                               users?             @relation("usersTousers", fields: [parentUserId], references: [id], onDelete: Cascade)
  other_users                         users[]            @relation("usersTousers")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum InquiryPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum InquiryStatus {
  PENDING
  REVIEWED
  RESPONDED
  CLOSED
}

enum Role {
  CUSTOMER
  PROVIDER
  ADMIN
}

enum ServiceRequestStatus {
  PENDING
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum SubRole {
  FAMILY_MEMBER
  CAREGIVER
}

enum VettedStatus {
  NOT_VETTED
  PENDING_REVIEW
  VETTED
  REJECTED
}
